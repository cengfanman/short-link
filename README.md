# çŸ­é“¾æ¥ç”Ÿæˆå™¨

ä¸€ä¸ªä½¿ç”¨ Next.js æ„å»ºçš„ç®€å•è€Œå¼ºå¤§çš„çŸ­é“¾æ¥ç”Ÿæˆå™¨ï¼Œé‡‡ç”¨Redisè¿›è¡Œæ•°æ®æŒä¹…åŒ–ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”— **çŸ­é“¾æ¥ç”Ÿæˆ**: å°†é•¿URLè½¬æ¢ä¸ºç®€çŸ­æ˜“åˆ†äº«çš„é“¾æ¥
- ğŸ”„ **æ™ºèƒ½é‡å®šå‘**: æ”¯æŒ301æ°¸ä¹…é‡å®šå‘åˆ°åŸå§‹URL
- ğŸ›¡ï¸ **è¾“å…¥éªŒè¯**: å®Œæ•´çš„URLéªŒè¯å’Œæ ‡å‡†åŒ–å¤„ç†
- ğŸ’¾ **Rediså­˜å‚¨**: ä½¿ç”¨Vercel Redisè¿›è¡Œé«˜æ€§èƒ½æ•°æ®æŒä¹…åŒ–
- ğŸ¨ **ç°ä»£ç•Œé¢**: å“åº”å¼Webç•Œé¢ï¼Œæ”¯æŒä¸€é”®å¤åˆ¶
- ğŸ§ª **å®Œæ•´æµ‹è¯•**: åŒ…å«å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒåŠŸèƒ½
- â˜ï¸ **äº‘ç«¯éƒ¨ç½²**: ä¼˜åŒ–é€‚é…Vercelå¹³å°éƒ¨ç½²
- ğŸ”§ **å¤šç¯å¢ƒæ”¯æŒ**: å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒå‡å¯ä½¿ç”¨Redis

## API ç«¯ç‚¹

### ç”ŸæˆçŸ­é“¾æ¥
```http
POST /api/links
Content-Type: application/json

{
  "url": "https://example.com/very-long-url"
}
```

**å“åº”:**
```json
{
  "shortUrl": "http://localhost:3000/s/ABC123G"
}
```

### è®¿é—®çŸ­é“¾æ¥
```http
GET /s/:slug
```

æˆåŠŸæ—¶è¿”å›301é‡å®šå‘åˆ°åŸå§‹URLï¼Œå¤±è´¥æ—¶è¿”å›404é”™è¯¯ã€‚

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 14 (App Router)
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: è‡ªå®šä¹‰CSSï¼ˆå“åº”å¼è®¾è®¡ï¼‰
- **æµ‹è¯•**: Jest + Testing Library
- **IDç”Ÿæˆ**: nanoid
- **æ•°æ®åº“**: Vercel Redis (æ ‡å‡†Rediså®¢æˆ·ç«¯)

## ç¯å¢ƒå˜é‡

### Redisé…ç½®
```bash
# .env.local
REDIS_URL="redis://username:password@host:port"
NODE_ENV=development
```

### è·å–Redis URL
1. åœ¨Vercel Dashboardåˆ›å»ºRedisæ•°æ®åº“
2. å¤åˆ¶è¿æ¥URLåˆ° `.env.local`
3. æˆ–ä½¿ç”¨Vercel CLIæ‹‰å–ç¯å¢ƒå˜é‡ï¼š
```bash
vercel env pull .env.local
```

## å¼€å‘æŒ‡å—

### å®‰è£…ä¾èµ–
```bash
pnpm install
```

### ç¯å¢ƒè®¾ç½®
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
cp .env.example .env.local

# ç¼–è¾‘ .env.local æ·»åŠ Redis URL
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
pnpm dev
```

è®¿é—® [http://localhost:3000](http://localhost:3000) æŸ¥çœ‹åº”ç”¨ã€‚

### è¿è¡Œæµ‹è¯•
```bash
pnpm test
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
pnpm build
pnpm start
```

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/links/          # çŸ­é“¾æ¥ç”ŸæˆAPI
â”‚   â”œâ”€â”€ s/[slug]/          # é‡å®šå‘è·¯ç”±
â”‚   â”œâ”€â”€ page.tsx           # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ layout.tsx         # åº”ç”¨å¸ƒå±€
â”‚   â””â”€â”€ globals.css        # å…¨å±€æ ·å¼
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ storage.ts         # Rediså­˜å‚¨å®ç°
â”‚   â”œâ”€â”€ utils.ts           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ shortLinkService.ts # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â””â”€â”€ __tests__/         # å•å…ƒæµ‹è¯•
```

## å­˜å‚¨æ–¹æ¡ˆ

### Rediså­˜å‚¨ç­–ç•¥
é¡¹ç›®é‡‡ç”¨æ™ºèƒ½å­˜å‚¨é€‰æ‹©ï¼š

- **Rediså¯ç”¨æ—¶**: ä½¿ç”¨Vercel Redisï¼ˆå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒï¼‰
- **Redisä¸å¯ç”¨æ—¶**: æ–‡ä»¶å­˜å‚¨ (`data/links.json`)
- **æœ€ç»ˆå¤‡ç”¨**: å†…å­˜å­˜å‚¨

### Vercel Redisç‰¹æ€§
- **é«˜æ€§èƒ½**: Rediså…¼å®¹çš„å†…å­˜æ•°æ®åº“
- **æŒä¹…åŒ–**: æ•°æ®è‡ªåŠ¨å¤‡ä»½å’ŒæŒä¹…åŒ–
- **æ‰©ç¼©å®¹**: æ ¹æ®éœ€æ±‚è‡ªåŠ¨æ‰©ç¼©å®¹
- **å®‰å…¨**: å†…ç½®SSL/TLSåŠ å¯†
- **ç›‘æ§**: å®æ—¶æ€§èƒ½ç›‘æ§

### æ•°æ®ç»“æ„
```redis
# é”®æ ¼å¼
shortlink:{slug} -> {originalUrl}

# ç¤ºä¾‹
shortlink:ABC123G -> "https://example.com/very-long-url"

# è¿‡æœŸæ—¶é—´: 1å¹´
TTL shortlink:ABC123G -> 31536000
```

## è®¾è®¡å†³ç­–

### å­˜å‚¨æ¶æ„
ä½¿ç”¨æ ‡å‡†Rediså®¢æˆ·ç«¯è€ŒéVercelç‰¹å®šåŒ…ï¼š
- æ›´å¥½çš„çµæ´»æ€§å’Œå…¼å®¹æ€§
- å®Œæ•´çš„RedisåŠŸèƒ½æ”¯æŒ
- æ›´å®¹æ˜“æµ‹è¯•å’Œè°ƒè¯•
- æ”¯æŒå¤šç§éƒ¨ç½²å¹³å°

### è¿æ¥ç®¡ç†
- æ™ºèƒ½è¿æ¥æ£€æµ‹å’Œé‡è¿
- è¿æ¥å¤ç”¨å’Œæ± åŒ–
- ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œé™çº§

### çŸ­ç ç”Ÿæˆ
ä½¿ç”¨ `nanoid` ç”Ÿæˆ7ä½URLå®‰å…¨çš„çŸ­æ ‡è¯†ç¬¦ï¼š
- é¿å…æ˜“æ··æ·†å­—ç¬¦ï¼ˆå¦‚ 0/O, 1/l/Iï¼‰
- ç¢°æ’æ¦‚ç‡æä½
- URLå®‰å…¨ï¼Œæ— éœ€ç¼–ç 

### æ ·å¼æ–¹æ¡ˆ
é‡‡ç”¨è‡ªå®šä¹‰CSSè€ŒéCSSæ¡†æ¶ï¼š
- å®Œå…¨å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯ä¼˜å…ˆï¼‰
- ç°ä»£è§†è§‰è®¾è®¡ï¼ˆæ¸å˜ã€é˜´å½±ã€åŠ¨ç”»ï¼‰
- è·¨æµè§ˆå™¨å…¼å®¹
- è½»é‡çº§ï¼Œæ— å¤–éƒ¨ä¾èµ–

### é”™è¯¯å¤„ç†
- å®Œæ•´çš„è¾“å…¥éªŒè¯
- æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯
- é€‚å½“çš„HTTPçŠ¶æ€ç 
- é˜²æ­¢å¸¸è§å®‰å…¨é—®é¢˜

## éƒ¨ç½²

### Vercel éƒ¨ç½²ï¼ˆæ¨èï¼‰
1. **åˆ›å»ºRedisæ•°æ®åº“**
   ```bash
   # åœ¨Vercel Dashboard -> Storage -> Create Database -> Redis
   ```

2. **è¿æ¥GitHubä»“åº“**
   - Forké¡¹ç›®åˆ°GitHub
   - åœ¨Vercelå¯¼å…¥ä»“åº“

3. **é…ç½®ç¯å¢ƒå˜é‡**
   - Vercelè‡ªåŠ¨æ³¨å…¥`REDIS_URL`
   - æˆ–æ‰‹åŠ¨æ·»åŠ ç¯å¢ƒå˜é‡

4. **éƒ¨ç½²**
   ```bash
   git push origin main  # è‡ªåŠ¨è§¦å‘éƒ¨ç½²
   # æˆ–ä½¿ç”¨CLI
   vercel --prod
   ```

### æœ¬åœ°å¼€å‘éƒ¨ç½²æµ‹è¯•
1. **é“¾æ¥Vercelé¡¹ç›®**
   ```bash
   vercel link
   ```

2. **æ‹‰å–ç¯å¢ƒå˜é‡**
   ```bash
   vercel env pull .env.local
   ```

3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
   ```bash
   pnpm dev
   ```

### å…¶ä»–å¹³å°éƒ¨ç½²
éƒ¨ç½²åˆ°å…¶ä»–å¹³å°éœ€è¦é…ç½®Rediså®ä¾‹ï¼š
- **Railway**: æ·»åŠ Redisæ’ä»¶
- **Render**: ä½¿ç”¨Render Redis
- **DigitalOcean**: ä½¿ç”¨Managed Redis
- **AWS**: ä½¿ç”¨ElastiCache
- **è‡ªæ‰˜ç®¡**: éƒ¨ç½²Rediså®¹å™¨

```bash
# Docker Composeç¤ºä¾‹
version: '3.8'
services:
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
  
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis
```

## æµ‹è¯•

é¡¹ç›®åŒ…å«å®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼š
- Rediså­˜å‚¨å±‚æµ‹è¯•
- ä¸šåŠ¡é€»è¾‘æµ‹è¯•
- å·¥å…·å‡½æ•°æµ‹è¯•
- APIç«¯ç‚¹æµ‹è¯•

è¿è¡Œæµ‹è¯•ï¼š
```bash
pnpm test           # è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test:watch     # ç›‘è§†æ¨¡å¼
```

## ç›‘æ§å’Œè°ƒè¯•

### Redisè¿æ¥çŠ¶æ€
åº”ç”¨å¯åŠ¨æ—¶ä¼šæ˜¾ç¤ºå­˜å‚¨ç±»å‹ï¼š
```
Using Redis storage for persistent data storage  # Rediså¯ç”¨
Using file-based storage for development        # Redisä¸å¯ç”¨
```

### é”™è¯¯å¤„ç†
- è‡ªåŠ¨é‡è¿æœºåˆ¶
- ä¼˜é›…é™çº§åˆ°æ–‡ä»¶å­˜å‚¨
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## æ€§èƒ½ä¼˜åŒ–

- **è¿æ¥å¤ç”¨**: å•ä¾‹Rediså®¢æˆ·ç«¯
- **è¿‡æœŸç­–ç•¥**: è‡ªåŠ¨æ¸…ç†è¿‡æœŸé“¾æ¥
- **å†…å­˜ä¼˜åŒ–**: é«˜æ•ˆçš„æ•°æ®ç»“æ„
- **ç¼“å­˜ç­–ç•¥**: Redisä½œä¸ºç¼“å­˜å±‚

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æ·»åŠ æµ‹è¯•å¹¶ç¡®ä¿é€šè¿‡
4. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
5. æ¨é€åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
6. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚
